
Intel 80386 (также известный как i386 или просто 386) — 32-битный процессор с архитектурой x86 третьего поколения фирмы Intel, выпущенный 17 октября 1985 года. Данный процессор был первым 32-разрядным процессором для IBM PC. Применялся, преимущественно, в настольных и портативных ПК. В настоящее время в основном используются в контроллерах.

Процессор i386 полностью совместим со своими предшественниками — процессорами 8086—80286. Он выполняет программы, предназначенные для них, без необходимости модификации кода и перекомпиляции (или с минимальными модификациями) и делает это более эффективно:

Вместе с тем i386 является серьёзной переработкой процессора 80286. По некоторым оценкам, ни до, ни после i386 архитектура процессоров x86 ни разу не переделывалась столь кардинально. В процессорах этой архитектуры впервые были введены основные механизмы поддержки современных 32-разрядных операционных систем для PC-совместимых платформ.

Основные изменения:

В i386 был введён новый механизм управления памятью — адресное пространство, к которому обращается процессор за данными и кодом, в котором располагаются сегменты (названное линейным адресным пространством) может не соответствовать реальной физической памяти. Физическая память (включая буфера внешних устройств, например, видеобуфер) может быть отображена в линейное адресное пространство произвольным образом — каждая страница (размером 4 килобайта) линейного пространства может быть переадресована на любую страницу физической памяти через каталог страниц, располагающийся в оперативной памяти (адрес каталога страниц определяется значением нового регистра управления «CR3»).

Как и сегменты, страницы линейного адресного пространства могут быть объявлены неприсутствующими (обращение к таким страницам вызывает обработчик страничного нарушения операционной системы). Неприсутствующие страницы, в первую очередь, используются для организации виртуальной памяти — обработчик страничного нарушения осуществляет свопинг страниц памяти с внешними запоминающими устройствами. Также неприсутствующие страницы используются в плоской модели памяти (где размер сегмента обычно имеет размер от 2 до 4 гигабайт, даже если у компьютера не имеется столько физической памяти) для маркировки страниц сегмента, в которые операционная система не выделила памяти. В этом случае страничное нарушение обычно завершает задачу или начинает её отладку.

Через страничное преобразование i386 может адресовать до 4 Гбайт физической памяти и до 64 Гбайт виртуальной памяти.

Поддержка многозадачности в процессорах x86 обозначает аппаратную поддержку «прозрачного» переключения с одной обычной программы (задачи) на другую. При переключении процессор сохраняет своё состояние (включая адрес следующей команды, селекторы сегментов) в сегменте состояния (TSS; сегмент памяти, с селектором из регистра TR) одной задачи, после чего восстанавливает состояние другой задачи из её сегмента состояния (селектор сегмента состояния новой задачи загружается из дескриптора её сегмента кода).

Переключение между задачами обычно осуществляется:

В i386 механизмы защиты и многозадачности были значительно расширены и улучшены. В зависимости от характера нарушений, они могут тихо игнорироваться (например, некоторые биты регистра EFLAGS нельзя изменить загрузкой флагов из стека), вызывать обработчик исключения (операционной системы). Серьёзные ошибки на уровне операционной системы (или в реальном режиме) могут привести процессор в режим аварийной остановки (например, при нарушении в обработчике двойного нарушения), из которого можно выйти только аппаратным сбросом (англ. reset) процессора.

Например, i386 поддерживает ограничение доступа к портам ввода-вывода и флагу запрещения
прерываний через:

Попытка исполнения неразрешенной команды ввода-вывода, приводит к исключению, обработчик
которого (принадлежащий операционной системе) может завершить задачу по ошибке, игнорировать (возобновить выполнение со следующей команды) или эмулировать ввод-вывод.

Кроме всего, многозадачность i386 полностью поддерживает все новые возможности — для 32-битных задач сегмент состояния содержит все 32-битные и необходимые новые регистры (например, регистр CR3 с адресом каталога страниц для этой задачи).

В процессоре i386 компания Intel учла необходимость лучшей поддержки реального режима, потому что программное обеспечение времени его появления не было готово полностью работать в защищённом режиме. Поэтому, например, в i386 возможно переключение из защищённого режима обратно в реальный (при разработке 80286 считалось, что это не потребуется, поэтому на компьютерах с процессором 80286 возврат в реальный режим осуществляется схемно — через сброс процессора).

В качестве расширенной поддержки реального режима i386 позволяет одной или нескольким задачам работать в виртуальном режиме — режиме эмуляции режима реального адреса.

Важно понимать, что «виртуальный режим», несмотря на похожесть названия, является не «третьим режимом работы процессора» (то есть реальный, защищённый и виртуальный), а лишь режимом работы задачи в многозадачном окружении защищённого режима.

Виртуальный режим предназначается для одновременного выполнения программ реального режима (например, программы для DOS) под многозадачной операционной системой защищённого режима.

Выполнение в виртуальном режиме практически идентично реальному, за несколькими исключениями, обусловленными тем, что виртуальная задача выполняется в защищённом режиме:

Например, начиная с версий 4.01 — 5.0, при использовании менеджера памяти EMM386 (и его аналогов других разработчиков) операционная система MS-DOS работает как задача в виртуальном режиме. EMM386 в этом случае является подобием операционной системы защищённого режима (передавая большинство системных прерываний ядру MS-DOS в виртуальной задаче).

Режим виртуального 8086 поддерживается и в последующих 32-битных процессорах x86, вплоть до режима совместимости в x86-64.

Как и в предыдущих процессорах (начиная с 8086), отладка в i386 осуществляется вызовом отладочного прерывания, обработчик которого передает управление программе-отладчику. В предыдущих процессорах отладка могла быть вызвана двумя событиями:

в i386-отладку также могут начать:

Пошаговое выполнение или трассировка (вызов отладочного прерывания после выполнения каждой команды при установленном флаге TF) в i386 осталось таким же, как и в предыдущих процессорах, работая во всех новых режимах (32-битной адресации и режиме виртуальной задачи).

Точка останова (англ. breakpoint) — прерывание выполнения программы по достижении определённого адреса.

В ранних процессорах x86 для организации точки останова было необходимо заменить первый байт команды на команду вызова отладочного прерывания (int 3), вызов прерывания возвращал управление отладчику, который возвращал исходное значение первого байта команды. Кроме всего, точки останова такого рода было невозможно устанавливать в ПЗУ. i386 поддерживает такие точки останова для совместимости.

Точки останова i386 определяются адресом в регистрах отладки. Обработчик отладки вызывается, если адрес следующей команды совпадает с адресом в регистре. В связи с тем, что такие точки останова не требуют записи в память, они могут использоваться для отладки программ в ПЗУ. i386 позволяет одновременно устанавливать до четырёх точек останова.

Точки останова i386 также могут быть установлены на обращение (чтение или запись) к переменной по заданному адресу в памяти. Процессор вызывает обработчик отладки при обращении команды к памяти по заданному адресу.

Отладочное прерывание может быть вызвано при переключении на задачу (для этого в сегменте состояния задачи предусмотрен специальный бит).

Линии данных и адресов в процессоре 80386, как и в процессоре 80286, не мультиплексируются: имеется 32 линии данных и 32 независимых от них линии адреса.

В составе микропроцессора имеются 8 32-битных регистров общего назначения (EAX, EBX, ECX, EDX, ESI, EDI, EBP, ESP). Младшая, 16-битная, половина каждого из этих регистров соответствует регистрам AX, BX, CX, DX, SI, DI, BP, SP в предыдущих процессорах семейства x86. Как и раньше, возможна адресация младших и старших 8-битных половин, младшей 16-битной половины 32-разрядных регистров данных (AL и AH, BL и BH, CL и CH, DL и DH). Регистр указателя команды и регистр флагов также стали 32-битными (EIP и EFLAGS соответственно), причём в регистре флагов добавлены новая группа флажков. К 4 16-битным сегментным регистрам (ES, CS, SS, DS) прибавились ещё 2 16-битных регистра (FS и GS), теперь стало 6 сегментных регистров. Добавлены несколько новых групп регистров (каждый регистр размером 32 бит): 3 регистра управления (CR0 (MSW), CR2, CR3), 8 регистров отладки (DR0, DR1, DR2, DR3, DR6, DR7), 2 тестовых регистра (TR6, TR7).

Набор инструкций i386 был расширен, в основном, за счёт добавления 32-битных вариантов существующих инструкций (образованных 32-битными префиксами), включая те, у которых 32-битные варианты имеют другие мнемоники (pushad/popad, pushfd/popfd, cwd*/cdq, movsd/cmpsd/scasd/lodsd/insd/outsd, iretd), а также команды mov для новых регистров. Другие новые инструкции:

Средняя длина инструкций составляет 3,2 байта.

Так же, как и в случае связки 80286-80287, обмен данными процессора 80386 с его сопроцессором шёл через порты с адресами 0F0H-0FFH, и, в принципе, небольшим дополнением схемы можно было подключить сопроцессор 80287 к процессору 80386DX[3][4], это предлагалось в качестве дешёвой альтернативы использованию сопроцессора 80387.

Специально для микропроцессоров Intel 80386 были разработаны математические сопроцессоры 387SX и 387DX, объединяемые единым наименованием Intel 80387. Эти сопроцессоры совместимы с процессорами 386SX и 386DX соответственно; так, сопроцессор 387DX возможно подключить к 32-разрядной шине процессора. В остальном, обе модели аналогичны математическому сопроцессору 80287, который также можно использовать вместе с процессором 80386.

С 1985 года было выпущено множество модификаций процессора i386, отличающихся между собой производительностью, потребляемой мощностью, разъёмами, корпусами и прочими характеристиками.

Первый процессор семейства 386 выпущен 13 октября 1985 года и имел тактовую частоту 16 МГц. После выпуска процессоров 386SX процессоры этой серии получили индекс ‘’DX’’ — ‘’D’’ouble-word e’’X’’ternal, что указывало на его 32-разрядную внешнюю шину. Процессор позиционировался как производительное решение для настольных систем. Производился процессор по CHMOS IV технологии и потреблял 400 мА, что значительно меньше, чем Intel 8086. 16 февраля 1987 года анонсирована модель с частотой 20 МГц; 4 апреля 1988 года с частотой 25 МГц и 10 апреля 1989 года с частотой 33 МГц. Процессор выпускался в корпусах PQFP-132 (такие процессоры имели литеру «NG» в начале названия, например, NG80386DX25) или в керамическом PGA-132 (такие процессоры имели литеру «A» в начале названия, например, A80386DX25)

Первые процессоры 386DX имели ошибку, которая иногда приводила к неверным результатам при работе с 32-разрядными числами в таких программах, как OS/2 2.x, UNIX/386, или Windows в расширенном режиме. Ошибка приводила к тому, что система зависала. Вследствие некоторых проблем, в том числе из-за отсутствия 32-битных операционных систем, устранить ошибку удалось лишь в апреле 1987 года. Уже вышедшие процессоры прошли проверку, в результате которой процессоры, не имеющие ошибки, были промаркированы двойным символом «сигма» и/или одним символом «IV», а с ошибкой — 16 BIT S/W ONLY.

Первая модель этого семейства была представлена 16 июня 1988 года и имела частоту 16 МГц, позже были представлены и более быстрые модели: 20 МГц (25 января 1989 года), 25 МГц и 33 МГц (оба процессора представлены 26 октября 1992 года). Процессоры позиционировались как решения для настольных ПК начального уровня и портативных ПК. Семейство SX отличалось от семейства DX тем, что у него разрядность внешней шины данных составляла 16 бит, а разрядность внешней шины адреса — 24 бит, в результате чего процессор мог адресовать только 16 Мбайт физической памяти, что делало вычислительные системы, построенные на его основе, аппаратно совместимыми с предыдущими процессорами Intel 80286. В то же время процессор 386SX мог выполнять все программы, написанные для 386DX, и это сделало его популярным для изготовления «Турбо-плат», например, Cumulus 386SX, Intel InBoard или Orchid Tiny Turbo.

В рамках серии SX были выпущены процессоры с маркировками 80386SXTA, 80386SXSA, 80386SXLP, которые представляли собой встраиваемые (embedded) процессоры (серия SXSA), процессоры низкого потребления (Low Power), а также использовались в других целях.

Первая модель этого семейства была представлена 15 октября 1990 года и имела частоту 20 МГц, позже была представлена модель 25 МГц (30 сентября 1991 года). Процессоры позиционировались как первые энергоэффективные микропроцессоры, специально предназначенные для портативных ПК. Семейство SL отличалось от семейства SX тем, что имело на кристалле также контроллер оперативной памяти, контроллер внешней кэш-памяти объёмом от 16 до 64 Кбайт и контроллер шины.

Представляет собой модификацию процессора 386SX. Процессор предназначался для встраиваемых приложений с высокой интеграцией и малой потребляемой мощностью. Ключевые особенности этого процессора — низкое энергопотребление, пониженное напряжение питания, расположенные на кристалле контроллер прерываний, микросхема выбора чипа, счётчики и таймеры, логика тестирования JTAG. Эта серия процессоров имела несколько модификаций: EXSA, EXTA, EXTB, EXTC. Максимальный ток, потребляемый процессорами, составляет 320 мА для процессоров серии EXTC и 140 мА для процессоров серии EXTB.

Использовался на борту различных орбитальных спутников и микроспутников и в NASA-овском проекте FlightLinux.

Intel i386DX, 25 МГц

Intel i386EXTC, 25 МГц

Intel i386CXSA, 25 МГц

Intel i386, упакованный фирмой IBM

Процессоры для upgrade (Cyrix and Texas Instruments)

На основе микропроцессоров 80386 фирмой IBM были созданы персональные компьютеры IBM AT 386 (семейство PC) и IBM PS/2-80 (семейство PS/2). В первом применялась ОС PC-DOS, а во втором — OS/2.

